<div class="flex flex-col h-full">
  <header class="mb-6">
    <h2 class="text-3xl font-bold text-green-400">Port Scanner</h2>
    <p class="text-green-600 mt-1">Check a target for common open web server ports.</p>
  </header>

  <div class="bg-yellow-900/50 border border-yellow-500/70 text-yellow-300 text-sm rounded-lg p-4 mb-6">
    <p><i class="fas fa-exclamation-triangle mr-2"></i><strong>Browser Limitation:</strong> This tool can only detect open ports running HTTP/S services (e.g., websites, APIs). It cannot perform a full TCP/UDP scan like Nmap due to browser security restrictions.</p>
  </div>

  <div class="bg-gray-800/50 border border-green-900/70 rounded-lg p-6">
    <div class="flex flex-col sm:flex-row items-center gap-4">
      <input 
        type="text" 
        [ngModel]="targetIp()" 
        (ngModelChange)="targetIp.set($event)"
        placeholder="Enter Target IP or Hostname"
        class="flex-grow w-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 placeholder-green-700 outline-none"
      />
      <button 
        (click)="scan()" 
        [disabled]="isScanning() || !targetIp()"
        [class]="isScanning() || !targetIp() ? 'bg-gray-600 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500'"
        class="w-full sm:w-auto px-8 py-2 text-gray-900 font-bold rounded transition-all duration-200"
      >
        @if (isScanning()) {
          <span><i class="fas fa-spinner fa-spin mr-2"></i>Scanning...</span>
        } @else {
          <span><i class="fas fa-search mr-2"></i>Scan Web Ports</span>
        }
      </button>
    </div>
  </div>

  @if (isScanning() || scanLog().length > 0) {
    <div class="mt-6 flex-grow bg-black border border-green-900/70 rounded-lg p-4 flex flex-col min-h-[300px]">
      <h3 class="text-xl font-semibold text-green-400 mb-2">Scan Output</h3>
      @if(isScanning()){
        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-4 overflow-hidden">
          <div class="bg-green-500 h-2.5 rounded-full" [style.width.%]="scanProgress()"></div>
        </div>
      }
      <div class="flex-grow flex gap-4">
        <div class="w-1/2 overflow-y-auto">
          <h4 class="text-lg font-semibold text-green-400 mb-2">Results</h4>
          <pre class="text-sm space-y-1">@for(result of scanResults(); track result.port){<p><span class="font-bold">{{result.port}}/tcp</span>
  <span [class]="result.status === 'open' ? 'text-green-300' : 'text-gray-500'">{{result.status | uppercase}}</span>
</p>}</pre>
        </div>
        <div class="w-1/2 overflow-y-auto border-l border-green-900/50 pl-4">
            <h4 class="text-lg font-semibold text-green-400 mb-2">Log</h4>
            <pre class="text-sm text-green-300/80 space-y-1">@for(line of scanLog(); track $index){<p class="whitespace-pre-wrap">> {{line}}</p>}</pre>
        </div>
      </div>
    </div>
  }

  <div class="mt-6 bg-gray-800/30 border border-green-900/50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
      <button (click)="showTutorial()" class="text-blue-400 hover:text-white font-bold">
          <i class="fas fa-question-circle mr-2"></i>Show Tutorial
      </button>
      <button (click)="getExplanation()" class="text-green-400 hover:text-white font-bold">
          <i class="fas fa-book-open mr-2"></i>How does this work?
      </button>
    </div>
    @if(isFetchingExplanation()){
      <p class="mt-4 text-green-500 animate-pulse">Asking the AI expert...</p>
    }
    @if(explanation()){
      <p class="mt-4 text-green-400/90 whitespace-pre-wrap">{{ explanation() }}</p>
    }
    @if(geminiService.error()){
      <p class="mt-4 text-red-500">{{ geminiService.error() }}</p>
    }
  </div>

</div>