<div class="flex flex-col h-full">
  <header class="mb-6">
    <h2 class="text-3xl font-bold text-green-400">Password Cracker</h2>
    <p class="text-green-600 mt-1">Crack a password hash using a dictionary attack in your browser.</p>
  </header>

  <div class="bg-gray-800/50 border border-green-900/70 rounded-lg p-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="md:col-span-2">
        <label for="hashInput" class="block text-sm font-medium text-green-400 mb-1">Password Hash</label>
        <input 
          id="hashInput"
          type="text" 
          [ngModel]="hashInput()" 
          (ngModelChange)="hashInput.set($event)"
          placeholder="Enter hash to crack"
          class="w-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 placeholder-green-700 outline-none"
        />
      </div>
      <div>
        <label for="hashType" class="block text-sm font-medium text-green-400 mb-1">Hash Type</label>
        <select 
          id="hashType"
          [ngModel]="hashType()"
          (ngModelChange)="hashType.set($event)"
          class="w-full h-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 outline-none"
        >
          <option>SHA-256</option>
          <option>SHA-1</option>
          <option>SHA-512</option>
        </select>
      </div>
    </div>
    <div class="mt-4 flex flex-col md:flex-row gap-4 items-center">
        <div class="flex-grow">
            <label for="wordlist" class="block text-sm font-medium text-green-400 mb-1">Wordlist</label>
            <div class="flex items-center gap-2">
                <select id="wordlist" [(ngModel)]="wordlistSource" class="bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 outline-none">
                    <option value="default">Default (small)</option>
                    <option value="custom" [disabled]="customWordlist().length === 0">Custom</option>
                </select>
                <label class="px-4 py-2 text-gray-900 font-bold rounded transition-all duration-200 bg-blue-500 hover:bg-blue-400 cursor-pointer">
                    <i class="fas fa-upload mr-2"></i> Upload
                    <input type="file" class="hidden" (change)="handleFileInput($event)" accept=".txt">
                </label>
            </div>
            @if(customWordlistName()){
                 <p class="text-xs text-green-500 mt-1">Loaded: {{customWordlistName()}} ({{customWordlist().length}} words)</p>
            }
        </div>
        <button 
          (click)="crack()" 
          [disabled]="isCracking()"
          [class]="isCracking() ? 'bg-gray-600 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500'"
          class="mt-4 w-full md:w-auto px-8 py-2 text-gray-900 font-bold rounded transition-all duration-200 self-end"
        >
          <span><i class="fas fa-bolt mr-2"></i>Start Cracking</span>
        </button>
         @if (isCracking()) {
          <button (click)="stop()" class="mt-4 w-full md:w-auto px-8 py-2 bg-red-600 hover:bg-red-500 text-gray-900 font-bold rounded transition-all duration-200 self-end">
            <i class="fas fa-stop mr-2"></i>Stop
          </button>
        }
    </div>
  </div>

  @if (isCracking() || crackResult()) {
    <div class="mt-6 flex-grow bg-black border border-green-900/70 rounded-lg p-4 flex flex-col min-h-[300px]">
        @if(crackResult(); as result) {
            <div class="text-center p-4 mb-4 rounded" [class]="result.found ? 'bg-green-500/20 border border-green-500' : 'bg-red-500/20 border border-red-500'">
                <h3 class="text-2xl font-bold" [class]="result.found ? 'text-green-300' : 'text-red-300'">
                    {{ result.found ? 'SUCCESS: Password Found!' : 'FAILURE: Not in Dictionary' }}
                </h3>
                @if(result.found) {
                    <p class="text-4xl text-white font-black my-2 animate-pulse break-all">{{ result.password }}</p>
                }
                <p class="text-sm text-gray-400">
                    {{ result.attempts }} attempts in {{ result.time.toFixed(2) }} seconds.
                </p>
            </div>
        }
        @if(isCracking()){
          <div class="w-full bg-gray-700 rounded-full h-4 mb-2 overflow-hidden relative border border-green-700">
            <div class="bg-green-500 h-full rounded-full transition-width duration-100" [style.width.%]="progress()"></div>
            <span class="absolute w-full h-full top-0 left-0 text-center text-xs text-white font-bold leading-4">{{progress().toFixed(0)}}%</span>
          </div>
        }
        <h3 class="text-xl font-semibold text-green-400 mb-2">Attack Log</h3>
        <pre class="flex-grow overflow-y-auto text-sm text-green-300/80 space-y-1">@for(line of attemptsLog(); track $index){<p class="whitespace-pre-wrap">> {{line}}</p>}</pre>
    </div>
  }
  
  <div class="mt-6 bg-gray-800/30 border border-green-900/50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
      <button (click)="showTutorial()" class="text-blue-400 hover:text-white font-bold">
          <i class="fas fa-question-circle mr-2"></i>Show Tutorial
      </button>
      <button (click)="getExplanation()" class="text-green-400 hover:text-white font-bold">
          <i class="fas fa-book-open mr-2"></i>What is Password Cracking?
      </button>
    </div>
    @if(isFetchingExplanation()){
      <p class="mt-4 text-green-500 animate-pulse">Asking the AI expert...</p>
    }
    @if(explanation()){
      <p class="mt-4 text-green-400/90 whitespace-pre-wrap">{{ explanation() }}</p>
    }
     @if(geminiService.error()){
      <p class="mt-4 text-red-500">{{ geminiService.error() }}</p>
    }
  </div>

</div>