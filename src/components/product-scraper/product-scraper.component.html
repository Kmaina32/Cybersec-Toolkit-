<div class="flex flex-col h-full">
  <header class="mb-6">
    <h2 class="text-3xl font-bold text-green-400">Product Data Scraper</h2>
    <p class="text-green-600 mt-1">Extract structured data from a live product page.</p>
  </header>

  <div class="bg-yellow-900/50 border border-yellow-500/70 text-yellow-300 text-sm rounded-lg p-4 mb-6">
    <p><i class="fas fa-exclamation-triangle mr-2"></i><strong>Educational Tool:</strong> For security reasons (CORS), browsers block requests to most websites. This tool is configured to work with the public API <a href="https://dummyjson.com/products" target="_blank" class="font-bold underline hover:text-yellow-100">dummyjson.com</a> to demonstrate real data scraping.</p>
  </div>

  <div class="bg-gray-800/50 border border-green-900/70 rounded-lg p-6">
    <div class="flex flex-col sm:flex-row items-center gap-4">
      <input 
        type="text" 
        [(ngModel)]="productUrl"
        placeholder="Enter a dummyjson.com product URL"
        class="flex-grow w-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 placeholder-green-700 outline-none"
      />
      <button 
        (click)="scrape()" 
        [disabled]="isLoading() || !productUrl()"
        [class]="isLoading() || !productUrl() ? 'bg-gray-600 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500'"
        class="w-full sm:w-auto px-8 py-2 text-gray-900 font-bold rounded transition-all duration-200"
      >
        @if (isLoading()) {
          <span><i class="fas fa-spinner fa-spin mr-2"></i>Scraping...</span>
        } @else {
          <span><i class="fas fa-cogs mr-2"></i>Scrape Product Data</span>
        }
      </button>
    </div>
  </div>

   @if (isLoading()) {
    <div class="mt-6 flex-grow flex items-center justify-center">
      <div class="text-center">
        <i class="fas fa-download text-5xl text-green-500 animate-pulse"></i>
        <p class="mt-4 text-lg text-green-400">Fetching live data from URL...</p>
      </div>
    </div>
  }

  @if (productData(); as product) {
    <div class="mt-6 flex-grow bg-black/50 border border-green-900/70 rounded-lg p-6 animate-fade-in flex flex-col lg:flex-row gap-6">
      <!-- Image Gallery -->
      <div class="lg:w-1/3">
        <div class="bg-gray-800/50 rounded-lg aspect-square mb-2 flex items-center justify-center overflow-hidden">
            @if(selectedImage()){
                <img [src]="selectedImage()" alt="Selected product image" class="max-w-full max-h-full object-contain">
            }
        </div>
        <div class="grid grid-cols-5 gap-2">
          @for(image of product.images; track image) {
            <div 
                (click)="selectImage(image)" 
                class="aspect-square bg-gray-900 rounded-md overflow-hidden cursor-pointer border-2"
                [class]="selectedImage() === image ? 'border-green-500' : 'border-transparent hover:border-green-700'">
                <img [src]="image" alt="Product thumbnail" class="w-full h-full object-cover">
            </div>
          }
        </div>
      </div>
      <!-- Product Info -->
      <div class="lg:w-2/3">
        <span class="px-3 py-1 text-xs font-medium bg-green-900/70 text-green-300 rounded-full">{{ product.category }}</span>
        <h3 class="text-3xl font-bold text-green-300 mt-2">{{ product.title }}</h3>
        <p class="text-lg text-green-500 font-semibold">{{ product.brand }}</p>
        <p class="my-4 text-green-300/90 leading-relaxed">{{ product.description }}</p>
        <div class="flex items-baseline gap-4 mt-4">
            <p class="text-4xl font-black text-white">${{ product.price }}</p>
            <p class="text-lg text-red-400 font-bold">{{ product.discountPercentage }}% OFF</p>
        </div>
        <div class="mt-4 text-sm text-yellow-400">
            <i class="fas fa-star"></i> {{ product.rating }} / 5.0 | <span class="text-green-500">{{ product.stock }} in stock</span>
        </div>
      </div>
    </div>
  }

  @if (error()) {
    <div class="mt-6 p-4 bg-red-900/50 border border-red-500/70 text-red-300 text-sm rounded-lg">
        <p><i class="fas fa-exclamation-circle mr-2"></i><strong>Error:</strong> {{ error() }}</p>
    </div>
  }

  <div class="mt-6 bg-gray-800/30 border border-green-900/50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
      <button (click)="showTutorial()" class="text-blue-400 hover:text-white font-bold">
          <i class="fas fa-question-circle mr-2"></i>Show Tutorial
      </button>
      <button (click)="getExplanation()" class="text-green-400 hover:text-white font-bold">
          <i class="fas fa-book-open mr-2"></i>What is Web Scraping?
      </button>
    </div>
    @if(isFetchingExplanation()){
      <p class="mt-4 text-green-500 animate-pulse">Asking the AI expert...</p>
    }
    @if(explanation()){
      <p class="mt-4 text-green-400/90 whitespace-pre-wrap">{{ explanation() }}</p>
    }
    @if(geminiService.error()){
      <p class="mt-4 text-red-500">{{ geminiService.error() }}</p>
    }
  </div>
</div>
