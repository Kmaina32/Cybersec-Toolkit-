<div class="flex flex-col h-full">
  <header class="mb-6">
    <h2 class="text-3xl font-bold text-green-400">Cryptography Lab</h2>
    <p class="text-green-600 mt-1">Experiment with classic and modern encryption algorithms.</p>
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-grow">
    <!-- Controls & Input -->
    <div class="bg-gray-800/50 border border-green-900/70 rounded-lg p-6 flex flex-col">
      <h3 class="text-xl font-semibold text-green-300 mb-4">Configuration</h3>

      <!-- Algorithm Selector -->
      <div class="mb-4">
        <label for="algorithm" class="block text-sm font-medium text-green-400 mb-1">Algorithm</label>
        <select id="algorithm" [ngModel]="algorithm()" (ngModelChange)="algorithm.set($event)" class="w-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 outline-none">
          <option value="caesar">Caesar Cipher (Shift)</option>
          <option value="vigenere">Vigen√®re Cipher (Keyword)</option>
          <option value="aes">AES-GCM (Modern Symmetric)</option>
        </select>
      </div>

      <!-- Mode Selector -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-green-400 mb-1">Mode</label>
        <div class="flex gap-2">
          <button (click)="mode.set('encrypt')" [class]="mode() === 'encrypt' ? 'bg-green-600 text-gray-900' : 'bg-gray-700 hover:bg-gray-600'" class="flex-1 py-2 rounded font-bold">Encrypt</button>
          <button (click)="mode.set('decrypt')" [class]="mode() === 'decrypt' ? 'bg-green-600 text-gray-900' : 'bg-gray-700 hover:bg-gray-600'" class="flex-1 py-2 rounded font-bold">Decrypt</button>
        </div>
      </div>
      
      <!-- Key Input -->
      <div class="mb-4">
        <label for="key" class="block text-sm font-medium text-green-400 mb-1">Key</label>
        <input id="key" type="text" [ngModel]="key()" (ngModelChange)="key.set($event)" class="w-full bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 placeholder-green-700 outline-none">
        @if (algorithm() === 'caesar') { <p class="text-xs text-green-600 mt-1">Enter a number (e.g., 3).</p> }
        @if (algorithm() === 'vigenere') { <p class="text-xs text-green-600 mt-1">Enter a keyword (e.g., 'secret').</p> }
        @if (algorithm() === 'aes') {
          <p class="text-xs text-green-600 mt-1">Enter a 16, 24, or 32 character key.</p>
          <div class="flex items-center gap-2 mt-2">
            <select [ngModel]="aesKeySize()" (ngModelChange)="aesKeySize.set(+$event)" class="bg-gray-700 border-gray-600 text-green-300 text-xs rounded px-2 py-1 outline-none">
                <option value="16">128-bit (16 chars)</option>
                <option value="24">192-bit (24 chars)</option>
                <option value="32">256-bit (32 chars)</option>
            </select>
            <button (click)="generateAesKey()" class="px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded transition-all duration-200 text-xs">
                <i class="fas fa-random mr-1"></i> Generate Key
            </button>
          </div>
        }
      </div>
      
      <!-- Input Text -->
      <div class="mb-4 flex-grow flex flex-col">
        <label for="inputText" class="block text-sm font-medium text-green-400 mb-1">Input Text</label>
        <textarea id="inputText" [(ngModel)]="inputText" rows="6" placeholder="Enter the text to process..." class="w-full flex-grow bg-gray-900 border-2 border-green-700/50 focus:border-green-500 focus:ring-0 text-green-300 rounded px-4 py-2 placeholder-green-700 outline-none"></textarea>
      </div>

      <button (click)="processText()" class="w-full px-8 py-3 bg-green-600 hover:bg-green-500 text-gray-900 font-bold rounded transition-all duration-200 text-lg">
        <i class="fas fa-cogs mr-2"></i> Process
      </button>

    </div>

    <!-- Output Section -->
    <div class="bg-black/50 border border-green-900/70 rounded-lg p-6 flex flex-col">
      <h3 class="text-xl font-semibold text-green-300 mb-4">Output</h3>
      
      @if(error()){
        <div class="bg-red-900/50 border border-red-500 text-red-300 text-sm rounded-lg p-4 mb-4">
          <p><i class="fas fa-exclamation-circle mr-2"></i><strong>Error:</strong> {{ error() }}</p>
        </div>
      }

      <div class="flex-grow bg-gray-900 rounded p-4">
        <pre class="w-full h-full text-green-300 whitespace-pre-wrap break-words overflow-y-auto">{{ outputText() || 'Result will appear here...' }}</pre>
      </div>
    </div>
  </div>

  <div class="mt-6 bg-gray-800/30 border border-green-900/50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
      <button (click)="showTutorial()" class="text-blue-400 hover:text-white font-bold">
          <i class="fas fa-question-circle mr-2"></i>Show Tutorial
      </button>
      <button (click)="getAlgorithmExplanation()" class="text-green-400 hover:text-white font-bold">
          <i class="fas fa-book-open mr-2"></i>Learn about {{ algorithmDisplayName() }}
      </button>
    </div>
    @if(isFetchingExplanation()){
      <p class="mt-4 text-green-500 animate-pulse">Asking the AI expert about {{ algorithmDisplayName() }}...</p>
    }
    @if(explanation()){
      <p class="mt-4 text-green-400/90 whitespace-pre-wrap">{{ explanation() }}</p>
    }
    @if(geminiService.error()){
      <p class="mt-4 text-red-500">{{ geminiService.error() }}</p>
    }
  </div>
</div>