<div class="flex flex-col h-full">
  <header class="mb-6">
    <h2 class="text-3xl font-bold text-green-400">SQL Injection Simulator</h2>
    <p class="text-green-600 mt-1">Write and execute queries against a simulated database to see how SQLi works.</p>
  </header>

  <div class="bg-gray-800/50 border border-green-900/70 rounded-lg p-6">
    <h3 class="text-xl font-semibold text-green-300 mb-2">Query Editor</h3>
    <p class="text-sm text-green-500 mb-4">The `users` table has `id`, `username`, `role`, and `password_hash` columns.</p>
    
    <div class="mb-4">
      <label for="payloads" class="block text-sm font-medium text-green-400 mb-1">Example Queries</label>
      <div class="flex flex-wrap gap-2">
          <button (click)="setPayload('normal')" class="text-xs px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded">Normal Login</button>
          <button (click)="setPayload('injection')" class="text-xs px-3 py-1 bg-red-600 hover:bg-red-500 rounded">Injection Attack</button>
      </div>
    </div>

    <textarea
      [(ngModel)]="queryInput"
      rows="4"
      placeholder="e.g., SELECT * FROM users;"
      class="w-full bg-gray-900 border-2 font-mono border-green-700/50 focus:border-green-500 focus:ring-0 text-yellow-300 rounded px-4 py-2 placeholder-green-700 outline-none"
    ></textarea>
    
    <button (click)="executeQuery()" class="mt-4 w-full px-8 py-2 bg-green-600 hover:bg-green-500 text-gray-900 font-bold rounded transition-all duration-200">
      <i class="fas fa-play mr-2"></i>Execute Query
    </button>
  </div>

  @if (queryResult(); as result) {
    <div class="mt-6 flex-grow bg-black border border-green-900/70 rounded-lg p-4 flex flex-col min-h-[300px]">
      <div class="p-4 mb-4 rounded" [class]="result.success ? 'bg-green-500/20 border border-green-500' : 'bg-red-500/20 border border-red-500'">
        <h3 class="text-xl font-bold" [class]="result.success ? 'text-green-300' : 'text-red-300'">
          {{ result.success ? 'Query Succeeded' : 'Query Failed' }}
        </h3>
        <p class="text-gray-300">{{ result.explanation }}</p>
      </div>
      <div>
        <h4 class="text-lg font-semibold text-green-400">Executed SQL Query:</h4>
        <pre class="bg-gray-900 p-2 rounded text-sm text-yellow-300 my-2 overflow-x-auto"><code>{{ result.query }}</code></pre>
      </div>
      <div>
        <h4 class="text-lg font-semibold text-green-400 mt-4">Database Result ({{result.rowCount}} rows):</h4>
        @if (result.data.length > 0) {
          <pre class="bg-gray-900 p-2 rounded text-sm text-white mt-2 overflow-y-auto max-h-48"><code>{{ result.data | json }}</code></pre>
        } @else {
          <p class="text-gray-500 mt-2">[No data returned]</p>
        }
      </div>
    </div>
  }

  <div class="mt-6 bg-gray-800/30 border border-green-900/50 rounded-lg p-4">
    <div class="flex flex-wrap gap-4">
       <button (click)="showTutorial()" class="text-blue-400 hover:text-white font-bold">
          <i class="fas fa-question-circle mr-2"></i>Show Tutorial
      </button>
      <button (click)="getExplanation()" class="text-green-400 hover:text-white font-bold">
          <i class="fas fa-book-open mr-2"></i>What is SQL Injection?
      </button>
    </div>
    @if(isFetchingExplanation()){
      <p class="mt-4 text-green-500 animate-pulse">Asking the AI expert...</p>
    }
    @if(explanation()){
      <p class="mt-4 text-green-400/90 whitespace-pre-wrap">{{ explanation() }}</p>
    }
     @if(geminiService.error()){
      <p class="mt-4 text-red-500">{{ geminiService.error() }}</p>
    }
  </div>

</div>